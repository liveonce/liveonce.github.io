<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    

    <!--Author-->
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Live Once"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Live Once"/>

    <!--Type page-->
    
        <meta property="og:type" content="website" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>Live Once</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
            <h1 id="main-title" class="title">Live Once</h1>
        
    </div>
</header>

        <section class="main">
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2018/07/19/新增设备监测数据/">
                新增设备监测数据
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2018-07-19</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult2 <span class="title">insert</span><span class="params">(DeviceEntity deviceEntity, String data)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</span><br><span class="line">    String dataType = UtilData.findDataTypeFromJson(data);</span><br><span class="line">    System.out.println(<span class="string">"dataType:"</span> + dataType);</span><br><span class="line">    <span class="comment">//更新设备的dataType</span></span><br><span class="line">    <span class="keyword">if</span> (dataType == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AjaxResult2(<span class="number">400</span>, <span class="string">"dataType null"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    String fieldsStr = <span class="string">""</span>;</span><br><span class="line">    String fieldList = <span class="string">""</span>;</span><br><span class="line">    List &lt; String &gt; values = <span class="keyword">new</span> ArrayList &lt; String &gt; ();</span><br><span class="line">    Object obj = <span class="keyword">new</span> Object(); <span class="comment">//设备数据实体对象</span></span><br><span class="line">    <span class="comment">//设备数据实体对象</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Field[] devicefs = deviceEntity.getClass().getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; devicefs.length; i++) &#123;</span><br><span class="line">            Field f = devicefs[i];</span><br><span class="line">            f.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">if</span> (f.getName().toLowerCase().equals(dataType.toLowerCase())) &#123;</span><br><span class="line">                obj = f.get(deviceEntity);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        System.out.println(<span class="string">"自动识别类型数据失败"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AjaxResult2(<span class="number">400</span>, <span class="string">"Auto find type data failed"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//设置值</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Field[] fs = obj.getClass().getDeclaredFields();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; fs.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!Constants.DEVICE_DATA_FIELDS_AUTO_FILTER_FIELDS.toLowerCase().contains(fs[i].getName().toLowerCase())) &#123;</span><br><span class="line">                Field f = fs[i];</span><br><span class="line">                f.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                fieldsStr += f.getName() + <span class="string">","</span>;</span><br><span class="line">                Object val = f.get(obj);</span><br><span class="line">                values.add(quoted(val.toString()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 传感器指标</span></span><br><span class="line">        fieldList = fieldList.substring(<span class="number">0</span>, fieldList.length() - <span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">"fieldList="</span> + fieldList);</span><br><span class="line">        deviceEntity.setFieldList(fieldList);</span><br><span class="line"></span><br><span class="line">        fieldsStr = fieldsStr.substring(<span class="number">0</span>, fieldsStr.length() - <span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        System.out.println(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    values.add(quoted(deviceEntity.getDeviceId()));</span><br><span class="line">    values.add(quoted(deviceEntity.getSN()));</span><br><span class="line">    values.add(quoted(deviceEntity.getUptime()));</span><br><span class="line">    values.add(quoted(UtilDate.DateTime()));</span><br><span class="line">    values.add(quoted(deviceEntity.getVersion()));</span><br><span class="line">    values.add(quoted(deviceEntity.getQuanity()));</span><br><span class="line">    values.add(quoted(UtilData.reverseDataType(dataType)));</span><br><span class="line">    values.add(quoted(deviceEntity.getFieldList()));</span><br><span class="line">    fieldsStr = UtilData.reverseDataType(dataType) + <span class="string">"("</span> + fieldsStr + <span class="string">","</span> + Constants.DEVICE_DATA_FIELDS_COMMON + <span class="string">")"</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//新增设备监测数据</span></span><br><span class="line">        ddDao.insert(fieldsStr, values);</span><br><span class="line">        <span class="comment">//修改device dataType</span></span><br><span class="line">        dDao.updateDeviceDataTypeBySN(UtilData.reverseDataType(dataType), deviceEntity.getSN());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AjaxResult2(<span class="number">0</span>, <span class="string">"ok"</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        System.out.println(e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AjaxResult2(<span class="number">400</span>, <span class="string">"server error"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">findDataTypeFromJson</span><span class="params">(String jsonStr)</span> </span>&#123;</span><br><span class="line">    String prefixStrFinal = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">char</span>[] strArr = jsonStr.toCharArray();</span><br><span class="line">    String prefixStr = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = jsonStr.indexOf(<span class="string">"Data"</span>) - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">if</span> (strArr[i] != <span class="string">'"'</span>) &#123;</span><br><span class="line">            prefixStr += strArr[i];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">char</span>[] prefixStrArr = prefixStr.toCharArray();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = prefixStrArr.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        prefixStrFinal += prefixStrArr[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> prefixStrFinal + <span class="string">"Data"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insert"</span> <span class="attr">statementType</span>=<span class="string">"STATEMENT"</span>&gt;</span></span><br><span class="line">        INSERT ignore INTO </span><br><span class="line">        $&#123;fieldsStr&#125;</span><br><span class="line">        VALUES </span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">"val"</span> <span class="attr">collection</span>=<span class="string">"values"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span>$&#123;val&#125;<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">reverseDataType</span><span class="params">(String dataType)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dataType != <span class="keyword">null</span> &amp;&amp; dataType.length() &gt; <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Data"</span> + dataType.substring(<span class="number">0</span>, dataType.indexOf(<span class="string">"Data"</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2018/07/19/使用DataTables生成设备数据详情/">
                使用DataTables生成设备数据详情
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2018-07-19</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h3 id="DataTables配置"><a href="#DataTables配置" class="headerlink" title="DataTables配置"></a>DataTables配置</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> table = $(<span class="string">'.table-sort'</span>).dataTable(&#123;</span><br><span class="line">    <span class="string">"iDisplayLength"</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="string">"oLanguage"</span>: &#123;</span><br><span class="line">        <span class="string">"sLengthMenu"</span>: <span class="string">"每页显示 _MENU_ 条记录"</span>,</span><br><span class="line">        <span class="string">"sInfo"</span>: <span class="string">"从 _START_ 到 _END_ ,共 _TOTAL_ 条数据"</span>,</span><br><span class="line">        <span class="string">"sInfoEmpty"</span>: <span class="string">"没有数据"</span>,</span><br><span class="line">        <span class="string">"sInfoFiltered"</span>: <span class="string">"(从 _MAX_ 条数据中检索)"</span>,</span><br><span class="line">        <span class="string">"sZeroRecords"</span>: <span class="string">"没有检索到数据"</span>,</span><br><span class="line">        <span class="string">"sLoadingRecords"</span>: <span class="string">"正在载入..."</span>,</span><br><span class="line">        <span class="string">"sProcessing"</span>: <span class="string">"正在载入..."</span>,</span><br><span class="line">        <span class="string">"sSearch"</span>: <span class="string">"搜索:"</span>,</span><br><span class="line">        <span class="string">"oPaginate"</span>: &#123;</span><br><span class="line">            <span class="string">"sFirst"</span>: <span class="string">"首页"</span>,</span><br><span class="line">            <span class="string">"sPrevious"</span>: <span class="string">"前一页"</span>,</span><br><span class="line">            <span class="string">"sNext"</span>: <span class="string">"后一页"</span>,</span><br><span class="line">            <span class="string">"sLast"</span>: <span class="string">"尾页"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"bDeferRender"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"bAutoWidth"</span>: <span class="literal">true</span>, <span class="comment">//自动宽度</span></span><br><span class="line">    <span class="string">"aaSorting"</span>: [</span><br><span class="line">        [<span class="number">1</span>, <span class="string">"desc"</span>]</span><br><span class="line">    ], <span class="comment">//默认第几个排序</span></span><br><span class="line">    <span class="string">"aoColumnDefs"</span>: [&#123;</span><br><span class="line">            <span class="string">"orderable"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"aTargets"</span>: [<span class="number">0</span>, <span class="number">5</span>, <span class="number">8</span>]</span><br><span class="line">        &#125;, <span class="comment">// 不参与排序的列</span></span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"bVisible"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"aTargets"</span>: [<span class="number">4</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"processing"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"serverSide"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"sAjaxSource"</span>: <span class="string">"&lt;%=basePathAdmin%&gt;/devices.do?method=dataquerylist"</span>, <span class="comment">//这个是请求的地址</span></span><br><span class="line">    <span class="string">"fnServerData"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">sSource, aoData, fnCallback</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> base = <span class="built_in">parseInt</span>(aoData[<span class="number">1</span>][<span class="string">"value"</span>]) * <span class="number">5</span>;</span><br><span class="line">        $(<span class="string">"#formfordata"</span>).ajaxSubmit(&#123;</span><br><span class="line">            url: sSource, <span class="comment">//这个就是请求地址对应sAjaxSource</span></span><br><span class="line">            data: &#123;</span><br><span class="line">                <span class="string">"draw"</span>: aoData[<span class="number">0</span>][<span class="string">"value"</span>],</span><br><span class="line">                <span class="string">"colsNum"</span>: aoData[<span class="number">1</span>][<span class="string">"value"</span>],</span><br><span class="line">                <span class="string">"colums"</span>: aoData[<span class="number">2</span>][<span class="string">"value"</span>],</span><br><span class="line">                <span class="string">"start"</span>: aoData[<span class="number">3</span>][<span class="string">"value"</span>],</span><br><span class="line">                <span class="string">"length"</span>: aoData[<span class="number">4</span>][<span class="string">"value"</span>],</span><br><span class="line">                <span class="string">"searchWord"</span>: aoData[base + <span class="number">5</span>][<span class="string">"value"</span>],</span><br><span class="line">                <span class="string">"sortingCol"</span>: aoData[base + <span class="number">7</span>][<span class="string">"value"</span>],</span><br><span class="line">                <span class="string">"order"</span>: aoData[base + <span class="number">8</span>][<span class="string">"value"</span>],</span><br><span class="line">                <span class="string">"searchCol"</span>: aoData[base + <span class="number">9</span>][<span class="string">"value"</span>],</span><br><span class="line">                <span class="string">"spotName"</span>: $(<span class="string">'#spotName option:selected'</span>).val(),</span><br><span class="line">            &#125;, <span class="comment">//这个是把datatable的一些基本数据传给后台,比如起始位置,每页显示的行数</span></span><br><span class="line">            type: <span class="string">'get'</span>,</span><br><span class="line">            dataType: <span class="string">"json"</span>,</span><br><span class="line">            <span class="keyword">async</span>: <span class="literal">true</span>,</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">                fnCallback(result); <span class="comment">//把返回的数据传给这个方法就可以了,datatable会自动绑定数据的</span></span><br><span class="line">                <span class="keyword">var</span> outerHeight = $(<span class="string">"#DataTables_Table_0_next"</span>).outerHeight();</span><br><span class="line">                <span class="keyword">var</span> height = outerHeight - <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">var</span> innerHeight = $(<span class="string">"#DataTables_Table_0_next"</span>).innerHeight();</span><br><span class="line">                <span class="keyword">var</span> top = outerHeight - innerHeight;</span><br><span class="line">                <span class="keyword">var</span> jumpinput = <span class="built_in">document</span>.createElement(<span class="string">"input"</span>);</span><br><span class="line">                jumpinput.type = <span class="string">"text"</span>;</span><br><span class="line">                jumpinput.name = <span class="string">"jumpinput"</span>;</span><br><span class="line">                jumpinput.id = <span class="string">"jumpinput"</span>;</span><br><span class="line">                <span class="comment">//添加属性</span></span><br><span class="line">                $(jumpinput).css(<span class="string">"margin-left"</span>, <span class="string">"6px"</span>);</span><br><span class="line">                $(jumpinput).css(<span class="string">"border"</span>, <span class="string">"1px solid #cacaca"</span>);</span><br><span class="line">                $(jumpinput).css(<span class="string">"position"</span>, <span class="string">"relative"</span>);</span><br><span class="line">                $(jumpinput).css(<span class="string">"top"</span>, <span class="string">"-"</span> + top + <span class="string">"px"</span>);</span><br><span class="line">                $(jumpinput).css(<span class="string">"width"</span>, <span class="string">"50px"</span>);</span><br><span class="line">                $(jumpinput).css(<span class="string">"height"</span>, height + <span class="string">"px"</span>);</span><br><span class="line">                $(jumpinput).css(<span class="string">"line-height"</span>, height + <span class="string">"px"</span>);</span><br><span class="line">                <span class="comment">//添加事件</span></span><br><span class="line">                $(jumpinput).keypress(<span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">var</span> keycode = (event.keyCode ? event.keyCode : event.which);</span><br><span class="line">                    <span class="keyword">if</span> (keycode == <span class="string">'13'</span>) &#123;</span><br><span class="line">                        <span class="comment">//获取页码</span></span><br><span class="line">                        <span class="keyword">var</span> pageIndex = $(jumpinput).val();</span><br><span class="line">                        pageIndex = <span class="built_in">parseInt</span>(pageIndex) - <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">if</span> (!<span class="built_in">isNaN</span>(pageIndex)) &#123;</span><br><span class="line">                            <span class="comment">//跳转</span></span><br><span class="line">                            $(<span class="string">'#DataTables_Table_0'</span>).dataTable().fnPageChange(pageIndex);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            layer.msg(<span class="string">"请输入整数!"</span>, &#123;</span><br><span class="line">                                icon: <span class="number">5</span>,</span><br><span class="line">                                time: <span class="number">1000</span></span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                $(<span class="string">"#DataTables_Table_0_next"</span>).after(jumpinput);</span><br><span class="line">            &#125;,</span><br><span class="line">            error: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;&#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;, <span class="comment">// 获取数据的处理函数</span></span><br><span class="line">    <span class="string">"rowId"</span>: <span class="string">'id'</span>,</span><br><span class="line">    <span class="string">"columns"</span>: [&#123;</span><br><span class="line">            <span class="string">"data"</span>: <span class="string">"checkBoxforDel"</span>,</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"checkBoxforDel"</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"&lt;input type='checkbox' name='' id='checkall' /&gt;"</span>,</span><br><span class="line">            render: <span class="function"><span class="keyword">function</span>(<span class="params">data, type, row, meta</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">'&lt;input type="checkbox" name="checkBoxforDel" class="checkBoxforDel" value="'</span> + row.id + <span class="string">'" /&gt;'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; &lt;</span><br><span class="line">        c: forEach items = <span class="string">"$&#123;dataFields&#125;"</span></span><br><span class="line">        <span class="keyword">var</span> = <span class="string">"field"</span> &gt; ,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"data"</span>: <span class="string">"$&#123;field&#125;"</span>,</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"$&#123;field&#125;"</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"$&#123;field.toUpperCase()&#125;"</span></span><br><span class="line">        &#125; &lt;</span><br><span class="line">        /c:forEach&gt;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"data"</span>: <span class="string">"options"</span>,</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"options"</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"操作"</span>,</span><br><span class="line">            <span class="string">"class"</span>: <span class="string">"f-14 td-manage"</span>,</span><br><span class="line">            render: <span class="function"><span class="keyword">function</span>(<span class="params">data, type, row, meta</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">'&lt;a title="删除" href="javascript:;" onclick="team_del(this,'</span> + row.id + <span class="string">')" class=ml-5 style=text-decoration:none&gt;&lt;i class=Hui-iconfont&gt;&amp;#xe6e2;&lt;/i&gt;&lt;/a&gt;'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="数据表格参数"><a href="#数据表格参数" class="headerlink" title="数据表格参数"></a>数据表格参数</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> DataTablesResult <span class="title">queryList</span><span class="params">(DataTables data)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//common begin</span></span><br><span class="line">    DataTablesResult &lt; Object &gt; result = <span class="keyword">new</span> DataTablesResult &lt; Object &gt; ();</span><br><span class="line">    result.setError(<span class="string">"缺少参数"</span>);</span><br><span class="line">    <span class="keyword">if</span> (data.getColums() == <span class="keyword">null</span> || data.getColums().length == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (data.getDraw() == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (data.getLength() == <span class="keyword">null</span> || data.getLength() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (data.getStart() == <span class="keyword">null</span> || data.getStart() &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    GetByPage params = <span class="keyword">new</span> GetByPage();</span><br><span class="line">    params.setOrderCol(data.getColums()[data.getSortingCol()]);</span><br><span class="line">    params.setSearchCols(UtilCols.Modify(data.getColums()));</span><br><span class="line">    params.setLength(data.getLength());</span><br><span class="line">    params.setOrder(data.getOrder());</span><br><span class="line">    params.setStart(data.getStart());</span><br><span class="line">    <span class="keyword">if</span> (data.getDataType() != <span class="keyword">null</span> &amp;&amp; !data.getDataType().equals(<span class="string">""</span>)) &#123;</span><br><span class="line">        params.setDataType(data.getDataType());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (data.getDeviceId() != <span class="keyword">null</span> &amp;&amp; !data.getDeviceId().equals(<span class="string">""</span>)) &#123;</span><br><span class="line">        params.setDeviceId(data.getDeviceId());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (data.getSn() != <span class="keyword">null</span> &amp;&amp; !data.getSn().equals(<span class="string">""</span>)) &#123;</span><br><span class="line">        params.setSn(data.getSn());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (data.getSearchWord() != <span class="keyword">null</span> &amp;&amp; !data.getSearchWord().equals(<span class="string">""</span>) &amp;&amp; data.getSearchWord().length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        params.setSearchWord(<span class="string">"%"</span> + data.getSearchWord() + <span class="string">"%"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        params.setSearchWord(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//common end</span></span><br><span class="line">    List list = ddDao.queryPage(params);</span><br><span class="line">    result.setDraw(data.getDraw());</span><br><span class="line">    result.setRecordsTotal(ddDao.getAllNum(params.getDataType(), params.getSn()));</span><br><span class="line">    <span class="keyword">if</span> (list != <span class="keyword">null</span>) &#123;</span><br><span class="line">        result.setRecordsFiltered(ddDao.queryPageNum(params));</span><br><span class="line">        result.setData(list);</span><br><span class="line">        result.setError(<span class="string">""</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        result.setError(<span class="string">"获取数据失败"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryPage"</span> <span class="attr">resultType</span>=<span class="string">"java.util.Map"</span>&gt;</span></span><br><span class="line">        SELECT d.*,e.deviceName FROM </span><br><span class="line">        $&#123;dataType&#125; d</span><br><span class="line">        LEFT JOIN device e</span><br><span class="line">        ON d.sn=e.sn</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"WHERE"</span> <span class="attr">suffixOverrides</span>=<span class="string">"AND"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"searchWord!=null"</span>&gt;</span></span><br><span class="line">            (d.deviceId like CONCAT('%',#&#123;searchWord&#125;,'%') OR</span><br><span class="line">            d.uptime like CONCAT('%',#&#123;searchWord&#125;,'%') OR </span><br><span class="line">            d.addtime like CONCAT('%',#&#123;searchWord&#125;,'%') OR </span><br><span class="line">            d.Version like CONCAT('%',#&#123;searchWord&#125;,'%') OR</span><br><span class="line">            d.Quanity like CONCAT('%',#&#123;searchWord&#125;,'%')   </span><br><span class="line">            ) AND</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"sn!=null"</span>&gt;</span></span><br><span class="line">            d.sn = #&#123;sn&#125; AND</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">'orderCol!=null'</span>&gt;</span></span><br><span class="line">            ORDER BY $&#123;orderCol&#125; $&#123;order&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        LIMIT $&#123;start&#125;,$&#123;length&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getAllNum"</span> <span class="attr">resultType</span>=<span class="string">"Integer"</span>&gt;</span></span><br><span class="line">        SELECT COUNT(*) FROM $&#123;dataType&#125; where sn = #&#123;sn&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryPageNum"</span> <span class="attr">resultType</span>=<span class="string">"Integer"</span>&gt;</span></span><br><span class="line">        SELECT COUNT(*)</span><br><span class="line">        FROM $&#123;dataType&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"WHERE"</span> <span class="attr">suffixOverrides</span>=<span class="string">"AND"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"searchWord!=null"</span>&gt;</span></span><br><span class="line">            (deviceId like CONCAT('%',#&#123;searchWord&#125;,'%') OR</span><br><span class="line">            uptime like CONCAT('%',#&#123;searchWord&#125;,'%') OR </span><br><span class="line">            addtime like CONCAT('%',#&#123;searchWord&#125;,'%') OR </span><br><span class="line">            Version like CONCAT('%',#&#123;searchWord&#125;,'%') OR</span><br><span class="line">            Quanity like CONCAT('%',#&#123;searchWord&#125;,'%')   </span><br><span class="line">            ) AND</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"sn!=null"</span>&gt;</span></span><br><span class="line">            sn = #&#123;sn&#125; AND</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="查询数据字段"><a href="#查询数据字段" class="headerlink" title="查询数据字段"></a>查询数据字段</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List &lt; String &gt; queryDataFields(String dataType) &#123;</span><br><span class="line">    List &lt; String &gt; dataFields = ddDao.queryDataFields(dataType);</span><br><span class="line">    String[] filterArr = Constants.DEVICE_DATA_QUERY_FILTER_FIELDS.split(<span class="string">","</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; filterArr.length; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = dataFields.size() - <span class="number">1</span>; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (filterArr[i].equals(dataFields.get(j))) &#123;</span><br><span class="line">                dataFields.remove(j);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dataFields;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryDataFields"</span> <span class="attr">resultType</span>=<span class="string">"String"</span>&gt;</span></span><br><span class="line">	select  distinct column_name  </span><br><span class="line">	from Information_schema.columns  </span><br><span class="line">	where table_Name = #&#123;dataType&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2018/07/19/搭建UDPServer/">
                搭建UDPServer
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2018-07-19</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="UDPServer"><a href="#UDPServer" class="headerlink" title="UDPServer"></a>UDPServer</h2><h3 id="功能概述："><a href="#功能概述：" class="headerlink" title="功能概述："></a>功能概述：</h3><p>搭建用于接收基于UDP传输的测试数据的UDPServer，在系统启动时，同时开启一个线程，监听指定的端口，接收数据并调用插件进行数据解析。</p>
<h3 id="功能说明："><a href="#功能说明：" class="headerlink" title="功能说明："></a>功能说明：</h3><p>在 Servlet API 中有一个 ServletContextListener 接口，它能够监听 ServletContext 对象的生命周期，实际上就是监听 Web 应用的生命周期。当Servlet 容器启动或终止Web 应用时，会触发ServletContextEvent 事件，该事件由ServletContextListener 来处理。在 ServletContextListener 接口中定义了处理ServletContextEvent 事件的两个方法。</p>
<h3 id="在web-xml中设置Spring监听器"><a href="#在web-xml中设置Spring监听器" class="headerlink" title="在web.xml中设置Spring监听器"></a>在web.xml中设置Spring监听器</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>cn.env.web.util.UDPServer<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:/config/Spring-*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UDPServer</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent servletContextEvent)</span> </span>&#123;</span><br><span class="line">        UDPThread udpThread = WebApplicationContextUtils.getRequiredWebApplicationContext(servletContextEvent.getServletContext()).getBean(UDPThread.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过注入的Bean启动线程</span></span><br><span class="line">        <span class="keyword">if</span> (udpThread != <span class="keyword">null</span>) &#123;</span><br><span class="line">            udpThread.execute();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"udpThread为null"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent servletContextEvent)</span> </span>&#123;</span><br><span class="line">        System.out.print(<span class="string">"contextDestroyed"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UDPThread</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 封装Bean中注入服务</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DeviceJsonService deviceJsonService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SpotDao spotDao;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DeviceService deviceService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DeviceDataInsertService deviceDataInsertService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UDPThread udpThread;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        udpThread = <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Server().start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 线程内部类，Thread或者Runnable均可</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// 1.创建服务器端 </span></span><br><span class="line">                    datagramsocket DatagramSocket server = <span class="keyword">new</span> DatagramSocket(<span class="number">8888</span>);</span><br><span class="line">                    <span class="comment">// 2.创建数据报，用于接收发送的数据</span></span><br><span class="line">                    <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                    DatagramPacket packet = <span class="keyword">new</span> DatagramPacket(bytes, bytes.length);</span><br><span class="line">                    <span class="comment">// 3.接收发送的数据</span></span><br><span class="line">                    server.receive(packet); <span class="comment">// 此方法会在接收到数据之前一直阻塞</span></span><br><span class="line">                    <span class="comment">// 4.读取数据进行封装</span></span><br><span class="line">                    JSONObject object = <span class="keyword">new</span> JSONObject(<span class="keyword">new</span> LinkedHashMap());</span><br><span class="line">                    object.put(<span class="string">"SocketAddress"</span>, packet.getSocketAddress().toString());</span><br><span class="line">                    object.put(<span class="string">"rawData"</span>, Utilty.bytesToHexString(bytes).substring(<span class="number">0</span>, packet.getLength() * <span class="number">2</span>));</span><br><span class="line">                    String UDPData = JSONObject.toJSONString(object);</span><br><span class="line">                    <span class="comment">// 5.保存到JSON数据库</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 关闭资源</span></span><br><span class="line">                    server.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2018/07/19/编解码插件的热加载/">
                编解码插件的热加载
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2018-07-19</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="插件开发"><a href="#插件开发" class="headerlink" title="插件开发"></a>插件开发</h2><h3 id="功能概述："><a href="#功能概述：" class="headerlink" title="功能概述："></a>功能概述：</h3><p>支持电信，联通的华为OceanConnect和移动的OneNET平台的数据解析，对不同平台，不同数据协议的NB-DTU所上传的16进制数据，进行CRC16(MODBUS)数据冗余校验，然后根据数据类型进行数据解析。</p>
<h3 id="功能说明："><a href="#功能说明：" class="headerlink" title="功能说明："></a>功能说明：</h3><ol>
<li>获取已上传至平台的插件的文件路径，以File形式加载，然后转化为URL；</li>
<li>实例化一个URLClassLoader，加载文件路径的URL，加载编解码类ProtocolAdapter，获取解码方法decode，invoke传参并执行；</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">File file = <span class="keyword">new</span> File(filePath);</span><br><span class="line">URL url = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    url = file.toURI().toURL();</span><br><span class="line">&#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">ClassLoader loader = <span class="keyword">new</span> URLClassLoader(<span class="keyword">new</span> URL[] &#123;</span><br><span class="line">    url</span><br><span class="line">&#125;);</span><br><span class="line">Class &lt;&lt; ? &gt; cls = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    cls = loader.loadClass(<span class="string">"com.ndww.codec.ProtocolAdapter"</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">Method method = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    method = cls.getMethod(<span class="string">"decode"</span>, String.class);</span><br><span class="line">&#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">Object o = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    o = method.invoke(<span class="keyword">null</span>, Sensordata);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2018/07/19/CRC16的Java实现/">
                CRC16的Java实现
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2018-07-19</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CRC16</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">byte</span>[] crc16_tab_h = &#123; (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>,</span><br><span class="line">            (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>,</span><br><span class="line">            (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>,</span><br><span class="line">            (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>,</span><br><span class="line">            (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">byte</span>[] crc16_tab_l = &#123; (<span class="keyword">byte</span>) <span class="number">0x00</span>, (<span class="keyword">byte</span>) <span class="number">0xC0</span>, (<span class="keyword">byte</span>) <span class="number">0xC1</span>, (<span class="keyword">byte</span>) <span class="number">0x01</span>, (<span class="keyword">byte</span>) <span class="number">0xC3</span>, (<span class="keyword">byte</span>) <span class="number">0x03</span>, (<span class="keyword">byte</span>) <span class="number">0x02</span>, (<span class="keyword">byte</span>) <span class="number">0xC2</span>, (<span class="keyword">byte</span>) <span class="number">0xC6</span>, (<span class="keyword">byte</span>) <span class="number">0x06</span>, (<span class="keyword">byte</span>) <span class="number">0x07</span>, (<span class="keyword">byte</span>) <span class="number">0xC7</span>, (<span class="keyword">byte</span>) <span class="number">0x05</span>, (<span class="keyword">byte</span>) <span class="number">0xC5</span>, (<span class="keyword">byte</span>) <span class="number">0xC4</span>, (<span class="keyword">byte</span>) <span class="number">0x04</span>, (<span class="keyword">byte</span>) <span class="number">0xCC</span>, (<span class="keyword">byte</span>) <span class="number">0x0C</span>, (<span class="keyword">byte</span>) <span class="number">0x0D</span>, (<span class="keyword">byte</span>) <span class="number">0xCD</span>, (<span class="keyword">byte</span>) <span class="number">0x0F</span>, (<span class="keyword">byte</span>) <span class="number">0xCF</span>, (<span class="keyword">byte</span>) <span class="number">0xCE</span>, (<span class="keyword">byte</span>) <span class="number">0x0E</span>, (<span class="keyword">byte</span>) <span class="number">0x0A</span>, (<span class="keyword">byte</span>) <span class="number">0xCA</span>, (<span class="keyword">byte</span>) <span class="number">0xCB</span>, (<span class="keyword">byte</span>) <span class="number">0x0B</span>, (<span class="keyword">byte</span>) <span class="number">0xC9</span>, (<span class="keyword">byte</span>) <span class="number">0x09</span>, (<span class="keyword">byte</span>) <span class="number">0x08</span>, (<span class="keyword">byte</span>) <span class="number">0xC8</span>, (<span class="keyword">byte</span>) <span class="number">0xD8</span>, (<span class="keyword">byte</span>) <span class="number">0x18</span>, (<span class="keyword">byte</span>) <span class="number">0x19</span>, (<span class="keyword">byte</span>) <span class="number">0xD9</span>, (<span class="keyword">byte</span>) <span class="number">0x1B</span>, (<span class="keyword">byte</span>) <span class="number">0xDB</span>, (<span class="keyword">byte</span>) <span class="number">0xDA</span>, (<span class="keyword">byte</span>) <span class="number">0x1A</span>, (<span class="keyword">byte</span>) <span class="number">0x1E</span>, (<span class="keyword">byte</span>) <span class="number">0xDE</span>, (<span class="keyword">byte</span>) <span class="number">0xDF</span>, (<span class="keyword">byte</span>) <span class="number">0x1F</span>, (<span class="keyword">byte</span>) <span class="number">0xDD</span>, (<span class="keyword">byte</span>) <span class="number">0x1D</span>, (<span class="keyword">byte</span>) <span class="number">0x1C</span>, (<span class="keyword">byte</span>) <span class="number">0xDC</span>, (<span class="keyword">byte</span>) <span class="number">0x14</span>, (<span class="keyword">byte</span>) <span class="number">0xD4</span>, (<span class="keyword">byte</span>) <span class="number">0xD5</span>, (<span class="keyword">byte</span>) <span class="number">0x15</span>, (<span class="keyword">byte</span>) <span class="number">0xD7</span>, (<span class="keyword">byte</span>) <span class="number">0x17</span>, (<span class="keyword">byte</span>) <span class="number">0x16</span>, (<span class="keyword">byte</span>) <span class="number">0xD6</span>, (<span class="keyword">byte</span>) <span class="number">0xD2</span>, (<span class="keyword">byte</span>) <span class="number">0x12</span>,</span><br><span class="line">            (<span class="keyword">byte</span>) <span class="number">0x13</span>, (<span class="keyword">byte</span>) <span class="number">0xD3</span>, (<span class="keyword">byte</span>) <span class="number">0x11</span>, (<span class="keyword">byte</span>) <span class="number">0xD1</span>, (<span class="keyword">byte</span>) <span class="number">0xD0</span>, (<span class="keyword">byte</span>) <span class="number">0x10</span>, (<span class="keyword">byte</span>) <span class="number">0xF0</span>, (<span class="keyword">byte</span>) <span class="number">0x30</span>, (<span class="keyword">byte</span>) <span class="number">0x31</span>, (<span class="keyword">byte</span>) <span class="number">0xF1</span>, (<span class="keyword">byte</span>) <span class="number">0x33</span>, (<span class="keyword">byte</span>) <span class="number">0xF3</span>, (<span class="keyword">byte</span>) <span class="number">0xF2</span>, (<span class="keyword">byte</span>) <span class="number">0x32</span>, (<span class="keyword">byte</span>) <span class="number">0x36</span>, (<span class="keyword">byte</span>) <span class="number">0xF6</span>, (<span class="keyword">byte</span>) <span class="number">0xF7</span>, (<span class="keyword">byte</span>) <span class="number">0x37</span>, (<span class="keyword">byte</span>) <span class="number">0xF5</span>, (<span class="keyword">byte</span>) <span class="number">0x35</span>, (<span class="keyword">byte</span>) <span class="number">0x34</span>, (<span class="keyword">byte</span>) <span class="number">0xF4</span>, (<span class="keyword">byte</span>) <span class="number">0x3C</span>, (<span class="keyword">byte</span>) <span class="number">0xFC</span>, (<span class="keyword">byte</span>) <span class="number">0xFD</span>, (<span class="keyword">byte</span>) <span class="number">0x3D</span>, (<span class="keyword">byte</span>) <span class="number">0xFF</span>, (<span class="keyword">byte</span>) <span class="number">0x3F</span>, (<span class="keyword">byte</span>) <span class="number">0x3E</span>, (<span class="keyword">byte</span>) <span class="number">0xFE</span>, (<span class="keyword">byte</span>) <span class="number">0xFA</span>, (<span class="keyword">byte</span>) <span class="number">0x3A</span>, (<span class="keyword">byte</span>) <span class="number">0x3B</span>, (<span class="keyword">byte</span>) <span class="number">0xFB</span>, (<span class="keyword">byte</span>) <span class="number">0x39</span>, (<span class="keyword">byte</span>) <span class="number">0xF9</span>, (<span class="keyword">byte</span>) <span class="number">0xF8</span>, (<span class="keyword">byte</span>) <span class="number">0x38</span>, (<span class="keyword">byte</span>) <span class="number">0x28</span>, (<span class="keyword">byte</span>) <span class="number">0xE8</span>, (<span class="keyword">byte</span>) <span class="number">0xE9</span>, (<span class="keyword">byte</span>) <span class="number">0x29</span>, (<span class="keyword">byte</span>) <span class="number">0xEB</span>, (<span class="keyword">byte</span>) <span class="number">0x2B</span>, (<span class="keyword">byte</span>) <span class="number">0x2A</span>, (<span class="keyword">byte</span>) <span class="number">0xEA</span>, (<span class="keyword">byte</span>) <span class="number">0xEE</span>, (<span class="keyword">byte</span>) <span class="number">0x2E</span>, (<span class="keyword">byte</span>) <span class="number">0x2F</span>, (<span class="keyword">byte</span>) <span class="number">0xEF</span>, (<span class="keyword">byte</span>) <span class="number">0x2D</span>, (<span class="keyword">byte</span>) <span class="number">0xED</span>, (<span class="keyword">byte</span>) <span class="number">0xEC</span>, (<span class="keyword">byte</span>) <span class="number">0x2C</span>, (<span class="keyword">byte</span>) <span class="number">0xE4</span>, (<span class="keyword">byte</span>) <span class="number">0x24</span>, (<span class="keyword">byte</span>) <span class="number">0x25</span>, (<span class="keyword">byte</span>) <span class="number">0xE5</span>, (<span class="keyword">byte</span>) <span class="number">0x27</span>, (<span class="keyword">byte</span>) <span class="number">0xE7</span>,</span><br><span class="line">            (<span class="keyword">byte</span>) <span class="number">0xE6</span>, (<span class="keyword">byte</span>) <span class="number">0x26</span>, (<span class="keyword">byte</span>) <span class="number">0x22</span>, (<span class="keyword">byte</span>) <span class="number">0xE2</span>, (<span class="keyword">byte</span>) <span class="number">0xE3</span>, (<span class="keyword">byte</span>) <span class="number">0x23</span>, (<span class="keyword">byte</span>) <span class="number">0xE1</span>, (<span class="keyword">byte</span>) <span class="number">0x21</span>, (<span class="keyword">byte</span>) <span class="number">0x20</span>, (<span class="keyword">byte</span>) <span class="number">0xE0</span>, (<span class="keyword">byte</span>) <span class="number">0xA0</span>, (<span class="keyword">byte</span>) <span class="number">0x60</span>, (<span class="keyword">byte</span>) <span class="number">0x61</span>, (<span class="keyword">byte</span>) <span class="number">0xA1</span>, (<span class="keyword">byte</span>) <span class="number">0x63</span>, (<span class="keyword">byte</span>) <span class="number">0xA3</span>, (<span class="keyword">byte</span>) <span class="number">0xA2</span>, (<span class="keyword">byte</span>) <span class="number">0x62</span>, (<span class="keyword">byte</span>) <span class="number">0x66</span>, (<span class="keyword">byte</span>) <span class="number">0xA6</span>, (<span class="keyword">byte</span>) <span class="number">0xA7</span>, (<span class="keyword">byte</span>) <span class="number">0x67</span>, (<span class="keyword">byte</span>) <span class="number">0xA5</span>, (<span class="keyword">byte</span>) <span class="number">0x65</span>, (<span class="keyword">byte</span>) <span class="number">0x64</span>, (<span class="keyword">byte</span>) <span class="number">0xA4</span>, (<span class="keyword">byte</span>) <span class="number">0x6C</span>, (<span class="keyword">byte</span>) <span class="number">0xAC</span>, (<span class="keyword">byte</span>) <span class="number">0xAD</span>, (<span class="keyword">byte</span>) <span class="number">0x6D</span>, (<span class="keyword">byte</span>) <span class="number">0xAF</span>, (<span class="keyword">byte</span>) <span class="number">0x6F</span>, (<span class="keyword">byte</span>) <span class="number">0x6E</span>, (<span class="keyword">byte</span>) <span class="number">0xAE</span>, (<span class="keyword">byte</span>) <span class="number">0xAA</span>, (<span class="keyword">byte</span>) <span class="number">0x6A</span>, (<span class="keyword">byte</span>) <span class="number">0x6B</span>, (<span class="keyword">byte</span>) <span class="number">0xAB</span>, (<span class="keyword">byte</span>) <span class="number">0x69</span>, (<span class="keyword">byte</span>) <span class="number">0xA9</span>, (<span class="keyword">byte</span>) <span class="number">0xA8</span>, (<span class="keyword">byte</span>) <span class="number">0x68</span>, (<span class="keyword">byte</span>) <span class="number">0x78</span>, (<span class="keyword">byte</span>) <span class="number">0xB8</span>, (<span class="keyword">byte</span>) <span class="number">0xB9</span>, (<span class="keyword">byte</span>) <span class="number">0x79</span>, (<span class="keyword">byte</span>) <span class="number">0xBB</span>, (<span class="keyword">byte</span>) <span class="number">0x7B</span>, (<span class="keyword">byte</span>) <span class="number">0x7A</span>, (<span class="keyword">byte</span>) <span class="number">0xBA</span>, (<span class="keyword">byte</span>) <span class="number">0xBE</span>, (<span class="keyword">byte</span>) <span class="number">0x7E</span>, (<span class="keyword">byte</span>) <span class="number">0x7F</span>, (<span class="keyword">byte</span>) <span class="number">0xBF</span>, (<span class="keyword">byte</span>) <span class="number">0x7D</span>, (<span class="keyword">byte</span>) <span class="number">0xBD</span>, (<span class="keyword">byte</span>) <span class="number">0xBC</span>, (<span class="keyword">byte</span>) <span class="number">0x7C</span>, (<span class="keyword">byte</span>) <span class="number">0xB4</span>, (<span class="keyword">byte</span>) <span class="number">0x74</span>,</span><br><span class="line">            (<span class="keyword">byte</span>) <span class="number">0x75</span>, (<span class="keyword">byte</span>) <span class="number">0xB5</span>, (<span class="keyword">byte</span>) <span class="number">0x77</span>, (<span class="keyword">byte</span>) <span class="number">0xB7</span>, (<span class="keyword">byte</span>) <span class="number">0xB6</span>, (<span class="keyword">byte</span>) <span class="number">0x76</span>, (<span class="keyword">byte</span>) <span class="number">0x72</span>, (<span class="keyword">byte</span>) <span class="number">0xB2</span>, (<span class="keyword">byte</span>) <span class="number">0xB3</span>, (<span class="keyword">byte</span>) <span class="number">0x73</span>, (<span class="keyword">byte</span>) <span class="number">0xB1</span>, (<span class="keyword">byte</span>) <span class="number">0x71</span>, (<span class="keyword">byte</span>) <span class="number">0x70</span>, (<span class="keyword">byte</span>) <span class="number">0xB0</span>, (<span class="keyword">byte</span>) <span class="number">0x50</span>, (<span class="keyword">byte</span>) <span class="number">0x90</span>, (<span class="keyword">byte</span>) <span class="number">0x91</span>, (<span class="keyword">byte</span>) <span class="number">0x51</span>, (<span class="keyword">byte</span>) <span class="number">0x93</span>, (<span class="keyword">byte</span>) <span class="number">0x53</span>, (<span class="keyword">byte</span>) <span class="number">0x52</span>, (<span class="keyword">byte</span>) <span class="number">0x92</span>, (<span class="keyword">byte</span>) <span class="number">0x96</span>, (<span class="keyword">byte</span>) <span class="number">0x56</span>, (<span class="keyword">byte</span>) <span class="number">0x57</span>, (<span class="keyword">byte</span>) <span class="number">0x97</span>, (<span class="keyword">byte</span>) <span class="number">0x55</span>, (<span class="keyword">byte</span>) <span class="number">0x95</span>, (<span class="keyword">byte</span>) <span class="number">0x94</span>, (<span class="keyword">byte</span>) <span class="number">0x54</span>, (<span class="keyword">byte</span>) <span class="number">0x9C</span>, (<span class="keyword">byte</span>) <span class="number">0x5C</span>, (<span class="keyword">byte</span>) <span class="number">0x5D</span>, (<span class="keyword">byte</span>) <span class="number">0x9D</span>, (<span class="keyword">byte</span>) <span class="number">0x5F</span>, (<span class="keyword">byte</span>) <span class="number">0x9F</span>, (<span class="keyword">byte</span>) <span class="number">0x9E</span>, (<span class="keyword">byte</span>) <span class="number">0x5E</span>, (<span class="keyword">byte</span>) <span class="number">0x5A</span>, (<span class="keyword">byte</span>) <span class="number">0x9A</span>, (<span class="keyword">byte</span>) <span class="number">0x9B</span>, (<span class="keyword">byte</span>) <span class="number">0x5B</span>, (<span class="keyword">byte</span>) <span class="number">0x99</span>, (<span class="keyword">byte</span>) <span class="number">0x59</span>, (<span class="keyword">byte</span>) <span class="number">0x58</span>, (<span class="keyword">byte</span>) <span class="number">0x98</span>, (<span class="keyword">byte</span>) <span class="number">0x88</span>, (<span class="keyword">byte</span>) <span class="number">0x48</span>, (<span class="keyword">byte</span>) <span class="number">0x49</span>, (<span class="keyword">byte</span>) <span class="number">0x89</span>, (<span class="keyword">byte</span>) <span class="number">0x4B</span>, (<span class="keyword">byte</span>) <span class="number">0x8B</span>, (<span class="keyword">byte</span>) <span class="number">0x8A</span>, (<span class="keyword">byte</span>) <span class="number">0x4A</span>, (<span class="keyword">byte</span>) <span class="number">0x4E</span>, (<span class="keyword">byte</span>) <span class="number">0x8E</span>, (<span class="keyword">byte</span>) <span class="number">0x8F</span>, (<span class="keyword">byte</span>) <span class="number">0x4F</span>, (<span class="keyword">byte</span>) <span class="number">0x8D</span>, (<span class="keyword">byte</span>) <span class="number">0x4D</span>,</span><br><span class="line">            (<span class="keyword">byte</span>) <span class="number">0x4C</span>, (<span class="keyword">byte</span>) <span class="number">0x8C</span>, (<span class="keyword">byte</span>) <span class="number">0x44</span>, (<span class="keyword">byte</span>) <span class="number">0x84</span>, (<span class="keyword">byte</span>) <span class="number">0x85</span>, (<span class="keyword">byte</span>) <span class="number">0x45</span>, (<span class="keyword">byte</span>) <span class="number">0x87</span>, (<span class="keyword">byte</span>) <span class="number">0x47</span>, (<span class="keyword">byte</span>) <span class="number">0x46</span>, (<span class="keyword">byte</span>) <span class="number">0x86</span>, (<span class="keyword">byte</span>) <span class="number">0x82</span>, (<span class="keyword">byte</span>) <span class="number">0x42</span>, (<span class="keyword">byte</span>) <span class="number">0x43</span>, (<span class="keyword">byte</span>) <span class="number">0x83</span>, (<span class="keyword">byte</span>) <span class="number">0x41</span>, (<span class="keyword">byte</span>) <span class="number">0x81</span>, (<span class="keyword">byte</span>) <span class="number">0x80</span>, (<span class="keyword">byte</span>) <span class="number">0x40</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 计算CRC16校验</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">  * 需要计算的数组</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> CRC16校验值</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">calcCrc16</span><span class="params">(<span class="keyword">byte</span>[] data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> calcCrc16(data, <span class="number">0</span>, data.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 计算CRC16校验</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">  * 需要计算的数组</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> offset</span></span><br><span class="line"><span class="comment">  * 起始位置</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> len</span></span><br><span class="line"><span class="comment">  * 长度</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> CRC16校验值</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">calcCrc16</span><span class="params">(<span class="keyword">byte</span>[] data, <span class="keyword">int</span> offset, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> calcCrc16(data, offset, len, <span class="number">0xffff</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 计算CRC16校验</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">  * 需要计算的数组</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> offset</span></span><br><span class="line"><span class="comment">  * 起始位置</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> len</span></span><br><span class="line"><span class="comment">  * 长度</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> preval</span></span><br><span class="line"><span class="comment">  * 之前的校验值</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> CRC16校验值</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">calcCrc16</span><span class="params">(<span class="keyword">byte</span>[] data, <span class="keyword">int</span> offset, <span class="keyword">int</span> len, <span class="keyword">int</span> preval)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ucCRCHi = (preval &amp; <span class="number">0xff00</span>) &gt;&gt; <span class="number">8</span>;</span><br><span class="line">        <span class="keyword">int</span> ucCRCLo = preval &amp; <span class="number">0x00ff</span>;</span><br><span class="line">        <span class="keyword">int</span> iIndex;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            iIndex = (ucCRCLo ^ data[offset + i]) &amp; <span class="number">0x00ff</span>;</span><br><span class="line">            ucCRCLo = ucCRCHi ^ crc16_tab_h[iIndex];</span><br><span class="line">            ucCRCHi = crc16_tab_l[iIndex];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ((ucCRCHi &amp; <span class="number">0x00ff</span>) &lt;&lt; <span class="number">8</span>) | (ucCRCLo &amp; <span class="number">0x00ff</span>) &amp; <span class="number">0xffff</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2018/07/19/编解码插件的开发/">
                编解码插件开发
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2018-07-19</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="插件开发"><a href="#插件开发" class="headerlink" title="插件开发"></a>插件开发</h2><h3 id="功能概述："><a href="#功能概述：" class="headerlink" title="功能概述："></a>功能概述：</h3><p>支持电信，联通的华为OceanConnect和移动的OneNET平台的数据解析，对不同平台，不同数据协议的NB-DTU所上传的16进制数据，进行CRC16(MODBUS)数据冗余校验，然后根据数据类型进行数据解析。</p>
<h3 id="功能说明："><a href="#功能说明：" class="headerlink" title="功能说明："></a>功能说明：</h3><ol>
<li>判断上传数据的所属平台，获取设备的16进制原始数据；</li>
<li>对数据进行CRC16校验，通过后，判断设备类型，利用工厂模式进行不同类型和传感器的数据解析；</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProtocolAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">decode</span><span class="params">(String sensorData)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ObjectNode objectNode = <span class="keyword">null</span>;</span><br><span class="line">            String value = <span class="keyword">null</span>;</span><br><span class="line">            StringBuffer sb = <span class="keyword">new</span> StringBuffer(sensorData);</span><br><span class="line">            <span class="keyword">if</span> (sensorData.contains(<span class="string">"notifyType"</span>)) &#123;</span><br><span class="line">                value = sb.substring(sensorData.indexOf(<span class="string">"rawData"</span>) + <span class="number">10</span>, sensorData.indexOf(<span class="string">"rsrp"</span>) - <span class="number">3</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sensorData.contains(<span class="string">"msg"</span>)) &#123;</span><br><span class="line">                value = sb.substring(sensorData.indexOf(<span class="string">"value"</span>) + <span class="number">8</span>, sensorData.indexOf(<span class="string">"dev_id"</span>) - <span class="number">3</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                value = sb.substring(sensorData.indexOf(<span class="string">"rawData"</span>) + <span class="number">10</span>, sensorData.length() - <span class="number">2</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">byte</span>[] binaryData = Utilty.hexStringToByte(value);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ((binaryData.length == Station.DATA_SIZE)) <span class="comment">// data report</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//CRC 校验</span></span><br><span class="line">                <span class="keyword">if</span> (CRC16.calcCrc16(binaryData, <span class="number">0</span>, <span class="number">38</span>) == SensorUtils.get2BytesIntValue(binaryData[<span class="number">39</span>], binaryData[<span class="number">38</span>])) &#123;</span><br><span class="line">                    <span class="keyword">int</span> deviceType = binaryData[<span class="number">2</span>];</span><br><span class="line">                    <span class="keyword">switch</span> (deviceType) &#123;</span><br><span class="line">                        <span class="keyword">case</span> AirStation.DEVICE_TYPE: <span class="comment">// air station</span></span><br><span class="line">                            objectNode = <span class="keyword">new</span> AirStation().decodeData(binaryData);</span><br><span class="line">                            sensorData = <span class="keyword">new</span> AirStation().transformData(objectNode);</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> BlackWaterStation.DEVICE_TYPE:</span><br><span class="line">                            objectNode = <span class="keyword">new</span> BlackWaterStation().decodeData(binaryData);</span><br><span class="line">                            sensorData = <span class="keyword">new</span> BlackWaterStation().transformData(objectNode);</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">default</span>:</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sensorData;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">byte</span> DEVICE_TYPE = <span class="number">0x01</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> ObjectNode <span class="title">decodeData</span><span class="params">(<span class="keyword">final</span> <span class="keyword">byte</span>[] binaryData)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    decodeFixedData(binaryData);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> speed = SensorUtils.get2BytesIntValue(binaryData[<span class="number">8</span>], binaryData[<span class="number">9</span>]);</span><br><span class="line">    <span class="keyword">float</span> direction = SensorUtils.get2BytesIntValue(binaryData[<span class="number">10</span>], binaryData[<span class="number">11</span>]);</span><br><span class="line">    <span class="keyword">float</span> temperature = <span class="number">0.0f</span>;</span><br><span class="line">    <span class="keyword">if</span> ((binaryData[<span class="number">12</span>] &amp; <span class="number">0xFF</span>) &lt; <span class="number">127</span>) &#123;</span><br><span class="line">        temperature = SensorUtils.get2BytesFloatValue(binaryData[<span class="number">12</span>], binaryData[<span class="number">13</span>], <span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        temperature = SensorUtils.get2BytesInvertFloatValue(binaryData[<span class="number">12</span>], binaryData[<span class="number">13</span>], <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">float</span> humidity = SensorUtils.get2BytesFloatValue(binaryData[<span class="number">14</span>], binaryData[<span class="number">15</span>], <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">float</span> press = SensorUtils.get2BytesFloatValue(binaryData[<span class="number">16</span>], binaryData[<span class="number">17</span>], <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">float</span> pm25 = SensorUtils.get2BytesIntValue(binaryData[<span class="number">18</span>], binaryData[<span class="number">19</span>]);</span><br><span class="line">    <span class="keyword">float</span> pm10 = SensorUtils.get2BytesIntValue(binaryData[<span class="number">20</span>], binaryData[<span class="number">21</span>]);</span><br><span class="line">    <span class="keyword">float</span> so2 = SensorUtils.get2BytesFloatValue(binaryData[<span class="number">22</span>], binaryData[<span class="number">23</span>], <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">float</span> co = SensorUtils.get2BytesFloatValue(binaryData[<span class="number">24</span>], binaryData[<span class="number">25</span>], <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">float</span> no2 = SensorUtils.get2BytesFloatValue(binaryData[<span class="number">26</span>], binaryData[<span class="number">27</span>], <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">float</span> o3 = SensorUtils.get2BytesFloatValue(binaryData[<span class="number">28</span>], binaryData[<span class="number">29</span>], <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    ObjectNode airData = objectMaper.createObjectNode();</span><br><span class="line">    airData.put(<span class="string">"SN"</span>, sn);</span><br><span class="line">    airData.put(<span class="string">"deviceId"</span>, sn);</span><br><span class="line">    airData.put(<span class="string">"Quanity"</span>, power);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (speed != <span class="number">65535f</span>) &#123;</span><br><span class="line">        airData.put(<span class="string">"Winds"</span>, speed / <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (direction != <span class="number">65535f</span>) &#123;</span><br><span class="line">        airData.put(<span class="string">"Windd"</span>, direction);</span><br><span class="line">    &#125;</span><br><span class="line">    temperature = (temperature - <span class="number">400</span>) / <span class="number">10</span>;</span><br><span class="line">    airData.put(<span class="string">"Temp"</span>, (<span class="keyword">float</span>) (Math.round(temperature * <span class="number">100</span>)) / <span class="number">100</span>);</span><br><span class="line">    airData.put(<span class="string">"Humi"</span>, humidity);</span><br><span class="line">    airData.put(<span class="string">"Press"</span>, press);</span><br><span class="line">    airData.put(<span class="string">"PM2_5"</span>, pm25);</span><br><span class="line">    airData.put(<span class="string">"PM10"</span>, pm10);</span><br><span class="line">    <span class="keyword">if</span> (so2 != <span class="number">65.535f</span>) &#123;</span><br><span class="line">        airData.put(<span class="string">"SO2"</span>, so2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (co != <span class="number">655.35f</span>) &#123;</span><br><span class="line">        airData.put(<span class="string">"CO"</span>, co);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (no2 != <span class="number">65.535f</span>) &#123;</span><br><span class="line">        airData.put(<span class="string">"NO2"</span>, no2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (o3 != <span class="number">65.535f</span>) &#123;</span><br><span class="line">        airData.put(<span class="string">"O3"</span>, o3);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> airData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">get2BytesIntValue</span><span class="params">(<span class="keyword">byte</span> high, <span class="keyword">byte</span> low)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = ((high &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">8</span>) + (low &amp; <span class="number">0xFF</span>);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">float</span> <span class="title">get2BytesFloatValue</span><span class="params">(<span class="keyword">byte</span> high, <span class="keyword">byte</span> low, <span class="keyword">int</span> scale)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">float</span> ret = <span class="number">0.0f</span>;</span><br><span class="line">    <span class="keyword">float</span> s = getScale(scale);</span><br><span class="line"></span><br><span class="line">    ret = (((high &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">8</span>) + (low &amp; <span class="number">0xFF</span>)) * s;</span><br><span class="line">    ret = <span class="keyword">new</span> BigDecimal(ret).setScale(scale, BigDecimal.ROUND_HALF_UP).floatValue();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">float</span> <span class="title">get2BytesInvertFloatValue</span><span class="params">(<span class="keyword">byte</span> high, <span class="keyword">byte</span> low, <span class="keyword">int</span> scale)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">float</span> ret = <span class="number">0.0f</span>;</span><br><span class="line">    <span class="keyword">float</span> s = getScale(scale);</span><br><span class="line"></span><br><span class="line">    ret = -((~(((high &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">8</span>) + (low &amp; <span class="number">0xFF</span>)) + <span class="number">1</span>) &amp; <span class="number">0xFFFF</span>) * s;</span><br><span class="line">    ret = <span class="keyword">new</span> BigDecimal(ret).setScale(scale, BigDecimal.ROUND_HALF_UP).floatValue();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2018/07/19/设备数据清洗/">
                设备数据清洗
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2018-07-19</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="模块说明"><a href="#模块说明" class="headerlink" title="模块说明:"></a>模块说明:</h2><p>重新设计“系统参数”模块，与设备管理做整合，调整系统参数写入方式，新增数据清洗功能，实现统一化设备信息管理。</p>
<h2 id="数据清洗"><a href="#数据清洗" class="headerlink" title="数据清洗"></a>数据清洗</h2><h3 id="功能概述："><a href="#功能概述：" class="headerlink" title="功能概述："></a>功能概述：</h3><p>根据设置的参数和偏移量，对设备数据进行数值修正。</p>
<h3 id="功能说明："><a href="#功能说明：" class="headerlink" title="功能说明："></a>功能说明：</h3><ol>
<li>获取传感器数据Sensordata中的SN；</li>
<li>获取所有设备设定的系统参数，非空则进行数据清洗；</li>
<li>匹配SN成功后，获取Sensordata中对应传感器的数值，进行系数和偏移值的计算后，重新还原到Sensordata。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">editData</span><span class="params">(String Sensordata)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   String sn2 = getSensordataFieldVal(<span class="string">"SN"</span>, Sensordata);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 查询参数</span></span><br><span class="line">  List&lt;DataParamEntity&gt; list = dDao.queryParams();</span><br><span class="line">      <span class="keyword">for</span> (DataParamEntity dpe : list) &#123;</span><br><span class="line">         <span class="keyword">if</span> (dpe != <span class="keyword">null</span> &amp;&amp; !<span class="string">""</span>.equals(dpe)) &#123;</span><br><span class="line">            String sn = String.valueOf(dpe.getSN());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 匹配SN    </span></span><br><span class="line"> <span class="keyword">if</span> (sn.equals(sn2)) &#123;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">if</span> (ifExistSensordataField(<span class="string">"NH4"</span>, Sensordata)) &#123;</span><br><span class="line">                  String cs = dpe.getNH4();</span><br><span class="line">                  <span class="keyword">if</span> (!<span class="string">"0"</span>.equals(cs)) &#123;</span><br><span class="line">                     String[] dvArr = cs.split(<span class="string">","</span>);</span><br><span class="line">                     String xishu = dvArr[<span class="number">0</span>];</span><br><span class="line">                     String pyzhi = dvArr[<span class="number">1</span>];</span><br><span class="line">                     <span class="comment">// 获取传感器数据对应字段的值</span></span><br><span class="line">  String fieldVal = getSensordataFieldVal(<span class="string">"NH4"</span>, Sensordata);</span><br><span class="line">                     Float finalVal = Float.parseFloat(fieldVal) * Float.parseFloat(xishu)</span><br><span class="line">                           + Float.parseFloat(pyzhi);</span><br><span class="line">                     finalVal = (<span class="keyword">float</span>)(Math.floor(finalVal*<span class="number">10</span>))/<span class="number">10</span>;</span><br><span class="line">                     <span class="comment">// 数据过滤</span></span><br><span class="line">  <span class="keyword">if</span> (finalVal &lt; <span class="number">0.0</span> || finalVal &gt; <span class="number">100.0</span>) &#123;</span><br><span class="line">                        BlaRriDataEntity bde = dsDao.queryDate(dpe.getSN());</span><br><span class="line">                        finalVal = bde.getNH4();</span><br><span class="line">                     &#125;</span><br><span class="line">                     Sensordata = recoverySensordata(<span class="string">"NH4"</span>, String.valueOf(finalVal), Sensordata);</span><br><span class="line">                  &#125;</span><br><span class="line"></span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      System.out.println(e.getMessage());</span><br><span class="line">   &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> Sensordata;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getSensordataFieldVal</span><span class="params">(String field,String Sensordata)</span></span>&#123;</span><br><span class="line">   field = field.toLowerCase();</span><br><span class="line">   Sensordata = Sensordata.toLowerCase();</span><br><span class="line">   <span class="keyword">int</span> fieldIndex = Sensordata.indexOf(field, <span class="number">0</span>);</span><br><span class="line">   <span class="keyword">if</span>(fieldIndex&lt;<span class="number">0</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">int</span> valBeginIndex = Sensordata.indexOf(<span class="string">":"</span>, fieldIndex);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">int</span> valEndIndex = Sensordata.indexOf(<span class="string">","</span>, fieldIndex);</span><br><span class="line">   String valStr = <span class="string">""</span>;</span><br><span class="line">   <span class="keyword">if</span>(valEndIndex&lt;<span class="number">0</span>)&#123;</span><br><span class="line">      valStr = Sensordata.substring(valBeginIndex+<span class="number">1</span>, Sensordata.length()-<span class="number">1</span>);</span><br><span class="line">   &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      valStr = Sensordata.substring(valBeginIndex+<span class="number">1</span>, valEndIndex);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> valStr.trim().replace(<span class="string">"&#125;"</span>, <span class="string">""</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">ifExistSensordataField</span><span class="params">(String field, String Sensordata)</span> </span>&#123;</span><br><span class="line">   String valStr = getSensordataFieldVal(field, Sensordata);</span><br><span class="line">   <span class="keyword">return</span> valStr == <span class="keyword">null</span> ? <span class="keyword">false</span> : <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">recoverySensordata</span><span class="params">(String field,String val,String Sensordata)</span></span>&#123;</span><br><span class="line">   String field1 = field.toLowerCase();</span><br><span class="line">   String Sensordata1 = Sensordata.toLowerCase();</span><br><span class="line">   <span class="keyword">int</span> fieldIndex = Sensordata1.indexOf(field1, <span class="number">0</span>);</span><br><span class="line">   <span class="keyword">int</span> valBeginIndex = Sensordata.indexOf(<span class="string">":"</span>, fieldIndex);</span><br><span class="line">   <span class="keyword">int</span> valEndIndex = Sensordata.indexOf(<span class="string">","</span>, fieldIndex);</span><br><span class="line">   String strPrefix = Sensordata.substring(<span class="number">0</span>, valBeginIndex+<span class="number">1</span>);</span><br><span class="line">   String strSubfix = Sensordata.substring(valEndIndex, Sensordata.length()); </span><br><span class="line">   String finalStr = strPrefix+val+strSubfix;</span><br><span class="line">   <span class="keyword">return</span> finalStr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryParams"</span> <span class="attr">resultType</span>=<span class="string">"DataParamEntity"</span>&gt;</span></span><br><span class="line">  SELECT SN,NH4,ORP,PH,ZS,COD,CODMN,DOVAL</span><br><span class="line">FROM device</span><br><span class="line">WHERE NH4!=0</span><br><span class="line">OR ORP!=0</span><br><span class="line">OR PH!=0</span><br><span class="line">OR ZS!=0</span><br><span class="line">OR COD!=0</span><br><span class="line">OR CODMN!=0</span><br><span class="line">OR DOVAL!=0 </span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2018/07/19/设备状态分析/">
                设备状态分析
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2018-07-19</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="模块说明"><a href="#模块说明" class="headerlink" title="模块说明:"></a>模块说明:</h2><p>新增模块“状态分析”，包括数据库设计，基于SSM框架分层业务实现，前端页面调试及操作优化以及本地测试，实现后台自动化分析设备的最新电池电量，传感器上传的数据是否异常，传输是否中断，以及获取中断时间，和计算前一天的丢包率，方便设备维护人员查看设备最新状态，根据设备实际情况，填写待维护事项。</p>
<h2 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h2><h3 id="功能概述："><a href="#功能概述：" class="headerlink" title="功能概述："></a>功能概述：</h3><p>添加Spring定时任务@Scheduled，每天根据设备数据定时分析设备状态。</p>
<h3 id="功能说明："><a href="#功能说明：" class="headerlink" title="功能说明："></a>功能说明：</h3><ol>
<li>查询附带设备数据最新上传时间(addtime)的设备状态信息；</li>
<li>根据addtime判断设备是否离线，若为null，则标记为“离线超7天”后跳过数据分析，否则进一步分析设备离线时间，并查询记录设备最新电量，以供参考；</li>
<li>若设备正常，则进行分析丢包率和传感器状态。</li>
</ol>
<h3 id="单独配置定时器-Scheduler-xml"><a href="#单独配置定时器-Scheduler-xml" class="headerlink" title="单独配置定时器 Scheduler.xml"></a>单独配置定时器 Scheduler.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt; <span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:task</span>=<span class="string">"http://www.springframework.org/schema/task"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">  http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">  http://www.springframework.org/schema/task </span></span></span><br><span class="line"><span class="tag"><span class="string">  http://www.springframework.org/schema/task/spring-task-3.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 定时任务 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">task:executor</span> <span class="attr">id</span>=<span class="string">"executor"</span> <span class="attr">pool-size</span>=<span class="string">"5"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">task:scheduler</span> <span class="attr">id</span>=<span class="string">"scheduler"</span> <span class="attr">pool-size</span>=<span class="string">"10"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">task:annotation-driven</span> <span class="attr">executor</span>=<span class="string">"executor"</span> <span class="attr">scheduler</span>=<span class="string">"scheduler"</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="配置web-xml"><a href="#配置web-xml" class="headerlink" title="配置web.xml"></a>配置web.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:/config/scheduler.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 每天凌晨02:0执行设备状态信息存储 </span></span><br><span class="line"><span class="meta">@Scheduled</span>(cron = <span class="string">"0 0 2 * * ?"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveStatusData</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 查询设备状态信息</span></span><br><span class="line">   List&lt;DeviceStatusEntity&gt; list = dsdDao.queryAll();</span><br><span class="line">   SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> (DeviceStatusEntity dse : list) &#123;</span><br><span class="line">      <span class="keyword">if</span>(dse.getAddtime() == <span class="keyword">null</span>) &#123;</span><br><span class="line">         dse.setTransStatus(<span class="string">"离线超7天"</span>);</span><br><span class="line">         dse.setAddtime(sdf.format(<span class="keyword">new</span> Date()));</span><br><span class="line">         <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">int</span> SN = dse.getSN();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 判断传输状态和获取中断时间</span></span><br><span class="line">	  String addtime = dse.getAddtime();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         Date date = sdf.parse(addtime);</span><br><span class="line">         Date now = <span class="keyword">new</span> Date();</span><br><span class="line">         now.setMinutes(now.getMinutes() - <span class="number">30</span>);</span><br><span class="line">         <span class="keyword">int</span> res = date.compareTo(now);</span><br><span class="line">         <span class="keyword">if</span> (res &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">long</span> s = <span class="keyword">new</span> Date().getTime() - date.getTime();</span><br><span class="line">            <span class="keyword">if</span> (s &lt; <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span>) &#123;</span><br><span class="line">               <span class="keyword">long</span> m = s / (<span class="number">1000</span> * <span class="number">60</span>);</span><br><span class="line">               dse.setTransStatus(<span class="string">"离线"</span> + m + <span class="string">"分钟"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s &lt; <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>) &#123;</span><br><span class="line">               <span class="keyword">long</span> m = s / (<span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span>);</span><br><span class="line">               dse.setTransStatus(<span class="string">"离线"</span> + m + <span class="string">"小时"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="keyword">long</span> m = s / (<span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>);</span><br><span class="line">               dse.setTransStatus(<span class="string">"离线"</span> + m + <span class="string">"天"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            String bp = dse.getBreakPoint();</span><br><span class="line">            bp = addtime;</span><br><span class="line">            dse.setBreakPoint(bp);</span><br><span class="line">            dse.setAddtime(sdf.format(<span class="keyword">new</span> Date()));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 查询最新一条数据,分析传感器状态</span></span><br><span class="line">  			String Q = dsdDao.queryQuanity(SN);</span><br><span class="line">            dse.setQuanity(Q);</span><br><span class="line">            dse.setSensorStatus(<span class="string">"/"</span>);</span><br><span class="line">            dse.setPLR(<span class="string">"/"</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            dse.setTransStatus(<span class="string">"正常"</span>);</span><br><span class="line">            dse.setAddtime(sdf.format(<span class="keyword">new</span> Date()));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 计算丢包率</span></span><br><span class="line">  			<span class="keyword">int</span> count = dsDao.queryPLR(SN);</span><br><span class="line">            DecimalFormat format = <span class="keyword">new</span> DecimalFormat(<span class="string">"0.00%"</span>);</span><br><span class="line">            Double dd = (<span class="number">1.0</span> - (<span class="keyword">double</span>) count / <span class="number">96</span>);</span><br><span class="line">            <span class="keyword">if</span>(dd &gt; <span class="number">0.1</span>) dse.setTransStatus(<span class="string">"丢包率异常"</span>);</span><br><span class="line">            String plr = format.format(dd);</span><br><span class="line">            dse.setPLR(plr);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//查询最新的电量</span></span><br><span class="line">  			String Q = dsdDao.queryQuanity(SN);</span><br><span class="line">            dse.setQuanity(Q);</span><br><span class="line">            <span class="comment">// 查询昨天一天的数据,分析传感器状态</span></span><br><span class="line">  			List&lt;BlaRriDataEntity&gt; bres = dsdDao.queryData(SN);</span><br><span class="line">            <span class="keyword">for</span> (BlaRriDataEntity bre : bres) &#123;</span><br><span class="line">               <span class="keyword">float</span> NH4 = bre.getNH4();</span><br><span class="line">               <span class="keyword">float</span> PH = bre.getPH();</span><br><span class="line">               <span class="keyword">float</span> ZS = bre.getZS();</span><br><span class="line">               <span class="keyword">float</span> ORP = bre.getORP();</span><br><span class="line">               <span class="keyword">float</span> CODMN = bre.getCODMn();</span><br><span class="line">               <span class="keyword">float</span> COD = bre.getCod();</span><br><span class="line">               <span class="keyword">float</span> DOVAL = bre.getDoVal();</span><br><span class="line">               <span class="comment">// 判断传感器数据是否异常</span></span><br><span class="line">  <span class="keyword">if</span> (NH4 &lt; <span class="number">0.0</span> || NH4 &gt; <span class="number">20.0</span> || PH &lt; <span class="number">0.0</span> || PH &gt; <span class="number">14.0</span> || ZS &lt; <span class="number">0.0</span> || ZS &gt; <span class="number">1000.0</span> || ORP &lt; -<span class="number">1500.0</span></span><br><span class="line">  || ORP &gt; <span class="number">1500.0</span> || CODMN &lt; <span class="number">0.0</span> || CODMN &gt; <span class="number">20.0</span> || COD &lt; <span class="number">0.0</span> || COD &gt; <span class="number">370.0</span></span><br><span class="line">  || DOVAL &lt; <span class="number">0.0</span> || DOVAL &gt; <span class="number">20.0</span>) &#123;</span><br><span class="line">                  dse.setSensorStatus(<span class="string">"数值异常"</span>);</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  dse.setSensorStatus(<span class="string">"正常"</span>);</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 保存数据到库</span></span><br><span class="line">  dsdDao.insert(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryAll"</span> <span class="attr">resultType</span>=<span class="string">"DeviceStatusEntity"</span>&gt;</span></span><br><span class="line">  SELECT d.SN,d.HSV,d.illumination,nbr.addtime,d.spotId</span><br><span class="line">   FROM devicestatus d</span><br><span class="line">  LEFT JOIN (SELECT SN,MAX(addtime) AS addtime FROM datablarri GROUP BY</span><br><span class="line">   SN) nbr</span><br><span class="line">  ON d.SN = nbr.SN </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryQuanity"</span> <span class="attr">resultType</span>=<span class="string">"String"</span>&gt;</span> </span><br><span class="line">	SELECT Quanity FROM datablarri </span><br><span class="line">	WHERE SN = #&#123;SN&#125; </span><br><span class="line">	ORDER BY id desc limit 1</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryPLR"</span> <span class="attr">resultType</span>=<span class="string">"Integer"</span>&gt;</span></span><br><span class="line">  SELECT COUNT(*) FROM datablarri</span><br><span class="line">   WHERE SN=#&#123;SN&#125;</span><br><span class="line">  AND DATE_FORMAT(addtime,'%Y-%m-%d') &amp;gt; DATE_SUB(CURDATE(),INTERVAL 2</span><br><span class="line">   DAY)</span><br><span class="line">   AND DATE_FORMAT(addtime,'%Y-%m-%d') &amp;lt; CURDATE()</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryData"</span> <span class="attr">resultType</span>=<span class="string">"BlaRriDataEntity"</span>&gt;</span></span><br><span class="line">  SELECT NH4,PH,ZS,ORP,CODMN,COD,DOVAL</span><br><span class="line">   FROM datablarri</span><br><span class="line">   WHERE SN=#&#123;SN&#125;</span><br><span class="line">  AND DATE_FORMAT(addtime,'%Y-%m-%d') &amp;gt; DATE_SUB(CURDATE(),INTERVAL 2</span><br><span class="line">   DAY)</span><br><span class="line">   AND DATE_FORMAT(addtime,'%Y-%m-%d') &amp;lt; CURDATE()</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insert"</span> <span class="attr">parameterType</span>=<span class="string">"java.util.ArrayList"</span>&gt;</span></span><br><span class="line">  INSERT INTO devicestatusdata</span><br><span class="line">   (SN,HSV,illumination,Quanity,deviceStatus,sensorStatus,transStatus,breakPoint,addtime,statusMsg,spotId,PLR)</span><br><span class="line">   VALUES</span><br><span class="line">   <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">"list"</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">  (</span><br><span class="line">      #&#123;list.SN&#125;,</span><br><span class="line">      #&#123;list.HSV&#125;,</span><br><span class="line">      #&#123;list.illumination&#125;,</span><br><span class="line">      #&#123;list.Quanity&#125;,</span><br><span class="line">      #&#123;list.deviceStatus&#125;,</span><br><span class="line">      #&#123;list.sensorStatus&#125;,</span><br><span class="line">      #&#123;list.transStatus&#125;,</span><br><span class="line">      #&#123;list.breakPoint&#125;,</span><br><span class="line">      #&#123;list.addtime&#125;,</span><br><span class="line">      #&#123;list.statusMsg&#125;,</span><br><span class="line">      #&#123;list.spotId&#125;,</span><br><span class="line">      #&#123;list.PLR&#125;</span><br><span class="line">  )</span><br><span class="line">   <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="实时查询"><a href="#实时查询" class="headerlink" title="实时查询"></a>实时查询</h2><h3 id="功能概述：-1"><a href="#功能概述：-1" class="headerlink" title="功能概述："></a>功能概述：</h3><p>考虑到设备部分数据的即时性，所以在查询设备状态信息时，对个别数据进行实时查询分析。</p>
<h3 id="功能说明：-1"><a href="#功能说明：-1" class="headerlink" title="功能说明："></a>功能说明：</h3><ol>
<li>查询设备最新一条数据的上传时间addtime；</li>
<li>根据addtime判断设备是否离线，若为null，则直接跳过，否则进一步分析设备离线时间，并查询记录设备最新电量；</li>
<li>若设备正常，则只刷新设备最新电量即可。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">for</span> (DeviceStatusEntity dse : list) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> SN = dse.getSN();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断传输状态和获取中断时间</span></span><br><span class="line">String addtime = dsdDao.queryTime(SN);</span><br><span class="line">    <span class="keyword">if</span>(addtime == <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">       Date date = sdf.parse(addtime);</span><br><span class="line">       Date now = <span class="keyword">new</span> Date();</span><br><span class="line">       now.setMinutes(now.getMinutes() - <span class="number">30</span>);</span><br><span class="line">       <span class="keyword">int</span> res = date.compareTo(now);</span><br><span class="line">       <span class="keyword">if</span> (res &lt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">long</span> s = <span class="keyword">new</span> Date().getTime() - date.getTime();</span><br><span class="line">          <span class="keyword">if</span> (s &lt; <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span>) &#123;</span><br><span class="line">             <span class="keyword">long</span> m = s / (<span class="number">1000</span> * <span class="number">60</span>);</span><br><span class="line">             dse.setTransStatus(<span class="string">"离线"</span> + m + <span class="string">"分钟"</span>);</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s &lt; <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>) &#123;</span><br><span class="line">             <span class="keyword">long</span> m = s / (<span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span>);</span><br><span class="line">             dse.setTransStatus(<span class="string">"离线"</span> + m + <span class="string">"小时"</span>);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">             <span class="keyword">long</span> m = s / (<span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>);</span><br><span class="line">             dse.setTransStatus(<span class="string">"离线"</span> + m + <span class="string">"天"</span>);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          String bp = dse.getBreakPoint();</span><br><span class="line">          bp = addtime;</span><br><span class="line">          dse.setBreakPoint(bp);</span><br><span class="line">          dse.setAddtime(sdf.format(<span class="keyword">new</span> Date()));</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 查询最新一条数据,分析传感器状态</span></span><br><span class="line">String Q = dsdDao.queryQuanity(SN);</span><br><span class="line">          dse.setQuanity(Q);</span><br><span class="line">          dse.setSensorStatus(<span class="string">"/"</span>);</span><br><span class="line">          dse.setPLR(<span class="string">"/"</span>);</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span>(!<span class="string">"丢包率异常"</span>.equals(dse.getTransStatus())) dse.setTransStatus(<span class="string">"正常"</span>);</span><br><span class="line"></span><br><span class="line">          dse.setBreakPoint(<span class="string">""</span>);</span><br><span class="line">          dse.setAddtime(sdf.format(<span class="keyword">new</span> Date()));</span><br><span class="line"></span><br><span class="line">          <span class="comment">//查询最新的电量</span></span><br><span class="line">String Q = dsdDao.queryQuanity(SN);</span><br><span class="line">          dse.setQuanity(Q);</span><br><span class="line">       &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">       e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryTime"</span> <span class="attr">resultType</span>=<span class="string">"String"</span>&gt;</span></span><br><span class="line">  SELECT addtime FROM datablarri WHERE SN = #&#123;SN&#125; ORDER BY id desc limit 1 </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2018/07/18/工厂模式/">
                工厂模式
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2018-07-18</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p>1.单例模式<br>如果一个类始终只能创建一个实例，则这个类成为单例类，这种设计模式称为单例模式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 使用一个类变量缓存创建的实例</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line">    <span class="comment">// 隐藏构造器</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 提供一个静态方法，用于返回Singleton实例</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 如果instance为null，表明还不曾创建Singleton对象</span></span><br><span class="line">        <span class="comment">// 如果instance不为null，则表明已经创建了Singleton对象，将不会执行该方法</span></span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 创建一个Singleton对象，并将其缓存起来</span></span><br><span class="line">            instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果instance已经创建过，直接返回</span></span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>写个测试程序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonTest</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 创建两个Singleton 对象</span></span><br><span class="line">        Singleton s1 = Singleton.getInstance();</span><br><span class="line">        Singleton s2 = Singleton.getInstance();</span><br><span class="line">        <span class="comment">// 将输出true</span></span><br><span class="line">        System.out.println(s1 == s2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Spring容器所管理的Bean实例默认是单例，可以通过scope来修改其行为方式。<br>使用单例模式的优势：<br>（1）减少系统开销（不用每次都创建新的实例）<br>（2）便于系统跟踪单个实例的生命周期与实例状态等。</p>
<p>2.简单工厂<br>通过工厂来创建对象的设计模式称为简单工厂模式。<br>当需要创建一个对象的时候不通过new 来创建，而是通过向工厂下订单来创建。<br>先定义一个房子（House），房子里面有张桌子（Table），还可以获得桌子的相关信息（getTableMaterial（）获得桌子的材料）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 一个House里面有张桌子table（这个table是抽象的，需要工厂根据用户的实际要求具体实现）</span></span><br><span class="line"><span class="comment"> * table通过工厂tableFactory来生产</span></span><br><span class="line"><span class="comment"> * tableFactory根据用户所要求的材料material来定制table</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">House</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Table table;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">House</span><span class="params">(Table table)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.table = table;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获得table 的material（所用材料）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getTableMaterial</span><span class="params">()</span></span>&#123;</span><br><span class="line">        table.getMaterial();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        TableFactory tableFactory = <span class="keyword">new</span> TableFactory();</span><br><span class="line">        <span class="comment">//通过工厂生产Table对象并传递给构造器</span></span><br><span class="line">        House house = <span class="keyword">new</span> House(tableFactory.getTable(<span class="string">"wood"</span>));</span><br><span class="line">        house.getTableMaterial();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面是Table接口，拥有Table的一般行为。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Table</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getMaterial</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面是三个具体的实现类（三种材质的桌子）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 木桌</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WoodTable</span> <span class="keyword">implements</span> <span class="title">Table</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getMaterial</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"Material of this Table is Wood!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 铁桌</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SteelTable</span> <span class="keyword">implements</span> <span class="title">Table</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getMaterial</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"Material of this Table is Steel!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 塑料桌</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PlasticTable</span> <span class="keyword">implements</span> <span class="title">Table</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getMaterial</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"Material of this Table is Plastic!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面是桌子工厂，可以根据用户的需求生产相应的桌子。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TableFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Table <span class="title">getTable</span><span class="params">(String material)</span></span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(material)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"wood"</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> WoodTable();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"steel"</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SteelTable();</span><br><span class="line">        <span class="keyword">default</span> :</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> PlasticTable();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面进行测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        TableFactory tableFactory = <span class="keyword">new</span> TableFactory();</span><br><span class="line">        <span class="comment">//工厂根据用户的需求生产Table对象并传递给构造器</span></span><br><span class="line">        House house = <span class="keyword">new</span> House(tableFactory.getTable(<span class="string">"wood"</span>));<span class="comment">//用户要求木桌(woodTable)</span></span><br><span class="line">        house.getTableMaterial();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>用户可以向工厂提出自己的需求（woodTable ,steelTable还是plasticTable），由工厂来生产Table（创建Table对象）；</p>
<p>简单工厂的优势：对象的调用者与对象的创建过程分离，避免对象的调用与实现以硬编码的方式耦合，提高系统的可维护性和可拓展性。</p>
<p>3.抽象工厂模式<br>抽象工厂简单地说是工厂的工厂，抽象工厂可以创建具体工厂，由具体工厂来产生具体产品。<br>来看个示例。<br>有一个汽车商店（CarShop），里面有一辆汽车（car），还可以获得汽车的相关信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarShop</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Car car;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CarShop</span><span class="params">(Car car)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.car = car;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获得汽车的相关信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getCarInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        car.getCarInfo();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="comment">//通过抽象工厂获得具体工厂</span></span><br><span class="line">        CarFactory cf = CarFactoryFactory.getCarFactory(<span class="string">"A"</span>);</span><br><span class="line">        <span class="comment">//通过具体工厂创建具体car对象并传递给构造器</span></span><br><span class="line">        CarShop cs = <span class="keyword">new</span> CarShop(cf.createCar(<span class="string">"BMW"</span>));</span><br><span class="line">        cs.getCarInfo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有一个抽象汽车工厂，用来根据用户需求创建具体汽车工厂。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarFactoryFactory</span> </span>&#123;</span><br><span class="line">    <span class="comment">//根据carType创建具体工厂</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CarFactory <span class="title">getCarFactory</span><span class="params">(String carType)</span></span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(carType)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"A"</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ACarFactory();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"B"</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> BCarFactory();</span><br><span class="line">        <span class="keyword">default</span> :</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> CCarFactory();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有A、B、C三个具体汽车工厂，用来生产三种类型的汽车。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A工厂</span></span><br><span class="line"><span class="comment"> * 根据用户要求的品牌（carBrand）</span></span><br><span class="line"><span class="comment"> * 生产A类型的汽车</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ACarFactory</span> <span class="keyword">implements</span> <span class="title">CarFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">createCar</span><span class="params">(String carBrand)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">switch</span>(carBrand)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"BMW"</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> BMWCarA();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"Benz"</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> BenzCarA();</span><br><span class="line">        <span class="keyword">default</span> :</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> AudiCarA();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* B工厂</span></span><br><span class="line"><span class="comment"> * 根据用户要求的品牌（carBrand）</span></span><br><span class="line"><span class="comment"> * 生产B类型的汽车</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BCarFactory</span> <span class="keyword">implements</span> <span class="title">CarFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* (non-Javadoc)</span></span><br><span class="line"><span class="comment">     * @see com.abstructFactory.CarFactory#createCar(java.lang.String)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">createCar</span><span class="params">(String carBrand)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(carBrand)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"BMW"</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> BMWCarB();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"Benz"</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> BenzCarB();</span><br><span class="line">        <span class="keyword">default</span> :</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> AudiCarB();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * C工厂</span></span><br><span class="line"><span class="comment"> * 根据用户要求的品牌（carBrand）</span></span><br><span class="line"><span class="comment"> * 生产C类型的汽车</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CCarFactory</span> <span class="keyword">implements</span> <span class="title">CarFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">createCar</span><span class="params">(String carBrand)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(carBrand)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"BMW"</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> BMWCarC();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"Benz"</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> BenzCarC();</span><br><span class="line">        <span class="keyword">default</span> :</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> AudiCarC();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这三个具体工厂类都实现了同一个汽车工厂接口，该接口拥有一般汽车工厂的行为。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CarFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">createCar</span><span class="params">(String carBrand)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>A、B、C三个具体汽车工厂分别生产三种品牌（BMW,Benz和Audi）的汽车。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A工厂生产的Audi汽车</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AudiCarA</span> <span class="keyword">implements</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getCarInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Audi car from ACarFactory"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A工厂生产的Benz汽车</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BenzCarA</span> <span class="keyword">implements</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getCarInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Benz car from ACarFactory"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A工厂生产的BMW汽车</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BMWCarA</span> <span class="keyword">implements</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getCarInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"BMW car from ACarFactory"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * B工厂生产的Audi汽车</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AudiCarB</span> <span class="keyword">implements</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getCarInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Audi car from BCarFactory"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * B工厂生产的Benz汽车</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BenzCarB</span> <span class="keyword">implements</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getCarInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Benz car from BCarFactory"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * B工厂生产的BMW汽车</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BMWCarB</span> <span class="keyword">implements</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getCarInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"BMW car from BCarFactory"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * C工厂生产的Audi汽车</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AudiCarC</span> <span class="keyword">implements</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getCarInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"BMW car from CCarFactory"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * C工厂生产的Benz汽车</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BenzCarC</span> <span class="keyword">implements</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getCarInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"BMW car from CCarFactory"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * C工厂生产的BMW汽车</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BMWCarC</span> <span class="keyword">implements</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getCarInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"BMW car from CCarFactory"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这些具体的汽车产品都实现了同一个接口（Car），该接口拥有汽车的一般行为。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getCarInfo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面来做个测试，用户要求一辆A工厂生产的BMW汽车：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="comment">//通过抽象工厂获得具体工厂</span></span><br><span class="line">        CarFactory cf = CarFactoryFactory.getCarFactory(<span class="string">"A"</span>);</span><br><span class="line">        <span class="comment">//通过具体工厂创建具体car对象并传递给构造器</span></span><br><span class="line">        CarShop cs = <span class="keyword">new</span> CarShop(cf.createCar(<span class="string">"BMW"</span>));</span><br><span class="line">        cs.getCarInfo();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>抽象工厂可以根据用户的需求，通过不同的具体工厂生产不同的产品。<br>那么抽象工厂模式有什么好处呢？假如采用简单工厂模式，假如只有A工厂，当用户要求一辆B类型的BMW时，就要修改A工厂代码来生产BMWCarB对象。所以，抽象工厂模式的优势是：对象的调用者与对象的实现类以及具体的工厂分离，代码的耦合性更低，系统可维护性以及可拓展性更高。<br>但是抽象工厂模式有个缺陷，就是当用户需求改变的时候，需要修改代码，然后需要重新编译，最好是将用户需求（可以看做用户订单）放在一个配置文件里面，由代码根据配置文件来创建相应的工厂以及实例，这样当用户需求发生改变的时候，只需要修改配置文件（产品订单）即可。<br>Spring IOC容器是一个抽象工厂，既可以管理Bean实例，还可以管理工厂实例。ApplicationContext.xml可以看作是系统的订单，容器根据这个订单生产相应的Bean。</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2018/07/18/观察者模式/">
                观察者模式
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2018-07-18</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h3 id="被观察的产品列表"><a href="#被观察的产品列表" class="headerlink" title="被观察的产品列表"></a>被观察的产品列表</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductList</span> <span class="keyword">extends</span> <span class="title">Observable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; productList = <span class="keyword">null</span>;<span class="comment">//产品列表    private static ProductList instance;//类唯一实例    private ProductList()&#123;&#125;//构造方法私有化    /**</span></span><br><span class="line"> * 取得唯一实例</span><br><span class="line">  * <span class="meta">@return</span> 产品列表唯一实例</span><br><span class="line">  */</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ProductList <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> ProductList();</span><br><span class="line">            instance.productList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 增加观察者（电商接口）</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> observer 观察者</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addProductListObserver</span><span class="params">(Observer observer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.addObserver(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新增产品</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> newProduct 新产品</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addProduct</span><span class="params">(String newProduct)</span> </span>&#123;</span><br><span class="line">        productList.add(newProduct);</span><br><span class="line">        System.out.println(<span class="string">"产品列表新增了产品："</span>+newProduct);</span><br><span class="line">        <span class="keyword">this</span>.setChanged();<span class="comment">//设置被观察对象发生变化</span></span><br><span class="line">  <span class="keyword">this</span>.notifyObservers(newProduct);<span class="comment">//通知观察者，并传递新产品</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="京东和淘宝电商接口"><a href="#京东和淘宝电商接口" class="headerlink" title="京东和淘宝电商接口"></a>京东和淘宝电商接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TBObserver</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Observable o, Object product)</span> </span>&#123;</span><br><span class="line">        String newProduct = (String) product;</span><br><span class="line">        System.out.println(<span class="string">"发送新产品【"</span>+newProduct+<span class="string">"】同步到淘宝商城"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDObserver</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Observable o, Object product)</span> </span>&#123;</span><br><span class="line">        String newProduct = (String) product;</span><br><span class="line">        System.out.println(<span class="string">"发送新产品【"</span>+newProduct+<span class="string">"】同步到京东商城"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试观察者模式<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ProductList observable = ProductList.getInstance();</span><br><span class="line">TBObserver tbObserver = <span class="keyword">new</span> TBObserver();</span><br><span class="line">JDObserver jdObserver = <span class="keyword">new</span> JDObserver();</span><br><span class="line">observable.addObserver(jdObserver);</span><br><span class="line">observable.addObserver(tbObserver);</span><br><span class="line">observable.addProduct(<span class="string">"新增产品1"</span>);</span><br></pre></td></tr></table></figure></p>

        </div>
    

</div>
            
        </section>
    </div>
</div>



    <div class="row">
        <div class="col-sm-12">
            <div class="wrap-pagination">
                <a class="disabled" href="/">
                    <i class="fa fa-chevron-left" aria-hidden="true"></i>
                </a>
                <a class="" href="/page/2/">
                    <i class="fa fa-chevron-right" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>




</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    This is a personal technology blog.
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2018/07/19/新增设备监测数据/">新增设备监测数据</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2018/07/19/使用DataTables生成设备数据详情/">使用DataTables生成设备数据详情</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2018/07/19/搭建UDPServer/">搭建UDPServer</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2018/07/19/编解码插件的热加载/">编解码插件的热加载</a>
            </li>
            
        </ul>
    </div>



            
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->



</body>

</html>